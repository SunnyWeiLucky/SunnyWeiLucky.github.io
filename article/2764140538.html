<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|oboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.helioswei.top",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:"Trebuchet",style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!0,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="​    源码编译需要很多的库的支持，一种是基础的库，一种是你需要的编解码信息的库"><meta property="og:type" content="article"><meta property="og:title" content="ffmpeg-源码编译支持GPU"><meta property="og:url" content="http://www.helioswei.top/article/2764140538.html"><meta property="og:site_name" content="Helios"><meta property="og:description" content="​    源码编译需要很多的库的支持，一种是基础的库，一种是你需要的编解码信息的库"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://www.helioswei.top/images/gnutls.png"><meta property="og:image" content="http://www.helioswei.top/images/gmp.png"><meta property="og:image" content="http://www.helioswei.top/images/libtasn1.png"><meta property="og:image" content="http://www.helioswei.top/images/unistring.png"><meta property="og:image" content="http://www.helioswei.top/images/P11.png"><meta property="og:image" content="http://www.helioswei.top/images/dnssec.png"><meta property="og:image" content="http://www.helioswei.top/images/ladspa.png"><meta property="og:image" content="http://www.helioswei.top/images/libass.png"><meta property="og:image" content="http://www.helioswei.top/images/libgsm.png"><meta property="og:image" content="http://www.helioswei.top/images/libmp3lame.png"><meta property="og:image" content="http://www.helioswei.top/images/libopencore_amrnb.png"><meta property="og:image" content="http://www.helioswei.top/images/openh264.png"><meta property="og:image" content="http://www.helioswei.top/images/libopenjp2.png"><meta property="og:image" content="http://www.helioswei.top/images/opus.png"><meta property="og:image" content="http://www.helioswei.top/images/libsoxr.png"><meta property="og:image" content="http://www.helioswei.top/images/go.png"><meta property="og:image" content="http://www.helioswei.top/images/speex.png"><meta property="og:image" content="http://www.helioswei.top/images/libtheora.png"><meta property="og:image" content="http://www.helioswei.top/images/ogg.png"><meta property="og:image" content="http://www.helioswei.top/images/vorbis.png"><meta property="og:image" content="http://www.helioswei.top/images/libx264.png"><meta property="og:image" content="http://www.helioswei.top/images/x265.png"><meta property="og:image" content="http://www.helioswei.top/images/libxvid.png"><meta property="og:image" content="http://www.helioswei.top/images/xvid.png"><meta property="og:image" content="c:/Users/Administrator/Desktop/leopard4.1/images/readme.png"><meta property="og:image" content="http://www.helioswei.top/images/bar.png"><meta property="og:image" content="http://www.helioswei.top/images/openal.png"><meta property="og:image" content="http://www.helioswei.top/images/libxcb.png"><meta property="og:image" content="http://www.helioswei.top/images/vga.png"><meta property="og:image" content="http://www.helioswei.top/images/hw.png"><meta property="og:image" content="http://www.helioswei.top/images/cuvid.png"><meta property="og:image" content="http://www.helioswei.top/images/drive.png"><meta property="article:published_time" content="2020-01-14T11:09:01.000Z"><meta property="article:modified_time" content="2021-03-01T02:04:04.272Z"><meta property="article:author" content="Helioswei"><meta property="article:tag" content="ffmpeg"><meta property="article:tag" content="GPU"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://www.helioswei.top/images/gnutls.png"><link rel="canonical" href="http://www.helioswei.top/article/2764140538.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>ffmpeg-源码编译支持GPU | Helios</title><script>var _hmt=_hmt||[];!function(){var c=document.createElement("script");c.src="https://hm.baidu.com/hm.js?3cc4cc512f6c5ac8a8cb2d249a9cc87c";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(c,e)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Helios</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">世人谓我恋长安，其实只恋长安某</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="about fa fa-user fa-fw"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa fa-tags fa-fw"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="categories fa fa-th fa-fw"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archives fa fa-archive fa-fw"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><a role="button" class="book-mark-link book-mark-link-fixed"></a> <a href="https://github.com/SunnyWeiLucky" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://www.helioswei.top/article/2764140538.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpeg"><meta itemprop="name" content="Helioswei"><meta itemprop="description" content="江南烟雨浓"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Helios"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> ffmpeg-源码编译支持GPU</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-01-14 19:09:01" itemprop="dateCreated datePublished" datetime="2020-01-14T19:09:01+08:00">2020-01-14</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-03-01 10:04:04" itemprop="dateModified" datetime="2021-03-01T10:04:04+08:00">2021-03-01</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Media/" itemprop="url" rel="index"><span itemprop="name">Media</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Media/video/" itemprop="url" rel="index"><span itemprop="name">video</span></a></span></span><span id="/article/2764140538.html" class="post-meta-item leancloud_visitors" data-flag-title="ffmpeg-源码编译支持GPU" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/article/2764140538.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/article/2764140538.html" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>7.9k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>7 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>​ 源码编译需要很多的库的支持，一种是基础的库，一种是你需要的编解码信息的库</p></blockquote><h2 id="一，ffmpeg源码的下载"><a href="#一，ffmpeg源码的下载" class="headerlink" title="一，ffmpeg源码的下载"></a>一，ffmpeg源码的下载</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">在git上找个你需要的版本的库，直接通过git下载</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;FFmpeg&#x2F;FFmpeg.git</span><br><span class="line"></span><br><span class="line">ffmpeg 版本 ffmpeg version n4.1.1-3-g53f3f52</span><br><span class="line">cuda 版本 CUDA Version 10.0.130（这个版本自带驱动，可以不用安装驱动）</span><br><span class="line">drive 驱动版本 Driver Version: 410.48 </span><br><span class="line">nv-codec-headers 版本 sdk&#x2F;8.1</span><br></pre></td></tr></table></figure><h2 id="二，基础环境的准备"><a href="#二，基础环境的准备" class="headerlink" title="二，基础环境的准备"></a>二，基础环境的准备</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install autoconf automake freetype-devel gcc gcc-c++ git libtool make nasm pkgconfig zlib-devel bzip2 bzip2-devel</span><br></pre></td></tr></table></figure><h2 id="三，编码过程"><a href="#三，编码过程" class="headerlink" title="三，编码过程"></a>三，编码过程</h2><h4 id="1，设置环境路径"><a href="#1，设置环境路径" class="headerlink" title="1，设置环境路径"></a>1，设置环境路径</h4><blockquote><p>​ 在 /etc/profile 文件中，设置 PKG_CONFIG_PATH 路径</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;profile</span><br><span class="line">export PKG_CONFIG_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;lib64&#x2F;pkgconfig:&#x2F;usr&#x2F;lib64&#x2F;pkgconfig:&#x2F;usr&#x2F;local&#x2F;lib&#x2F;pkgconfig:&#x2F;usr&#x2F;lib&#x2F;pkgconfig</span><br></pre></td></tr></table></figure><h4 id="2，编码"><a href="#2，编码" class="headerlink" title="2，编码"></a>2，编码</h4><blockquote><p>​ 配置好configure之后，通过make可以一步步试探你缺少的库是什么，然后在下载，编译</p><p>下载完之后，通过命令来配置你需要的东西<br>./configure –help</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">make 编译的常用命令</span><br><span class="line">.&#x2F;configure</span><br><span class="line">make -j 10 (编译，并行10个核来一起编译，可以取消)</span><br><span class="line">make install (安装)</span><br><span class="line">make disclean (卸载)</span><br><span class="line">make clean (清除编译)</span><br></pre></td></tr></table></figure><h4 id="3，解决gnutls的问题"><a href="#3，解决gnutls的问题" class="headerlink" title="3，解决gnutls的问题"></a>3，解决gnutls的问题</h4><p><img src="/images/gnutls.png" alt="gnutls"></p><blockquote><p>我们需要手动的安装gnutls，gnutls3.5.19版本的可以，大于这个版本的有问题,</p><p><a target="_blank" rel="noopener" href="http://www.linuxfromscratch.org/blfs/view/svn/postlfs/gnutls.html">http://www.linuxfromscratch.org/blfs/view/svn/postlfs/gnutls.html</a></p><p>有安装的方法</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1,安装gnutls需要先安装gnutls，所有先手动下载这个</span><br><span class="line">wget https:&#x2F;&#x2F;ftp.gnu.org&#x2F;gnu&#x2F;nettle&#x2F;nettle-3.1.1.tar.gz</span><br><span class="line">tar zxf nettle-3.1.1.tar.gz  </span><br><span class="line">.&#x2F;configure --enable-shared</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">2,安装gnutls</span><br><span class="line">wget https:&#x2F;&#x2F;www.gnupg.org&#x2F;ftp&#x2F;gcrypt&#x2F;gnutls&#x2F;v3.5&#x2F;gnutls-3.5.19.tar.xz</span><br><span class="line">xz  -d gnutls-3.5.19.tar.xz</span><br><span class="line">tar xf gnutls-3.5.19.tar</span><br><span class="line">cd gnutls-3.5.19</span><br><span class="line">.&#x2F;configure --enable-shared</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p>在安装gnutls时，我们使用./configure –enable-shared时，可能遇到以下的问题;</p><ul><li><p><img src="/images/gmp.png" alt="gmp"></p><blockquote><p>解决：</p><p>yum install gmp-devel</p></blockquote></li><li><p><img src="/images/libtasn1.png" alt="libtasn1.png"></p><blockquote><p>解决：</p><p>yum install libffi libffi-devel</p><p>./configure –enable-shared –with-included-libtasn1</p></blockquote></li></ul><ul><li><p><img src="/images/unistring.png" alt="unistring.png"></p><blockquote><p>解决：</p><p>yum install libunistring-devel</p><p>./configure –enable-shared –with-included-libtasn1 –with-included-unistring</p></blockquote></li><li><p><img src="/images/P11.png" alt="P11.png"></p><blockquote><p>解决：</p><p>yum install p11-kit-devel</p></blockquote></li><li><p><img src="/images/dnssec.png" alt="dnssec.png"></p><blockquote><p>yum install unbound unbound-devel unbound-libs</p><p>./configure –enable-shared –with-included-libtasn1 –with-included-unistring</p></blockquote></li></ul><h4 id="4，解决ladspa-h的问题"><a href="#4，解决ladspa-h的问题" class="headerlink" title="4，解决ladspa.h的问题"></a>4，解决ladspa.h的问题</h4><p><img src="/images/ladspa.png" alt="ladspa.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install  ladspa*</span><br></pre></td></tr></table></figure><h4 id="5，解决libass的问题"><a href="#5，解决libass的问题" class="headerlink" title="5，解决libass的问题"></a>5，解决libass的问题</h4><p><img src="/images/libass.png" alt="libass.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libass*</span><br></pre></td></tr></table></figure><h4 id="6，解决libdc1394-2的问题"><a href="#6，解决libdc1394-2的问题" class="headerlink" title="6，解决libdc1394-2的问题"></a>6，解决libdc1394-2的问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1,官网下载源码</span><br><span class="line">https:&#x2F;&#x2F;sourceforge.net&#x2F;projects&#x2F;libdc1394&#x2F;files&#x2F;libdc1394-2&#x2F;</span><br><span class="line">2，编译</span><br><span class="line">.&#x2F;configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h4 id="7，解决libgsm的问题"><a href="#7，解决libgsm的问题" class="headerlink" title="7，解决libgsm的问题"></a>7，解决libgsm的问题</h4><p><img src="/images/libgsm.png" alt="libgsm.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gsm-tools gsm-devel</span><br></pre></td></tr></table></figure><h4 id="8，解决libmp3lame版本的问题"><a href="#8，解决libmp3lame版本的问题" class="headerlink" title="8，解决libmp3lame版本的问题"></a>8，解决libmp3lame版本的问题</h4><p><img src="/images/libmp3lame.png" alt="libmp3lame.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">源码安装，地址</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;gypified&#x2F;libmp3lame.git</span><br><span class="line">.&#x2F;configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h4 id="9，解决libopencore-amrnb的问题"><a href="#9，解决libopencore-amrnb的问题" class="headerlink" title="9，解决libopencore_amrnb的问题"></a>9，解决libopencore_amrnb的问题</h4><p><img src="/images/libopencore_amrnb.png" alt="libopencore_amrnb.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">官网下载源码，再手动编译</span><br><span class="line">https:&#x2F;&#x2F;sourceforge.net&#x2F;projects&#x2F;opencore-amr&#x2F;files&#x2F;opencore-amr&#x2F;</span><br><span class="line"> .&#x2F;configure</span><br><span class="line"> make</span><br><span class="line"> make install</span><br></pre></td></tr></table></figure><h4 id="10，解决opencv的问题"><a href="#10，解决opencv的问题" class="headerlink" title="10，解决opencv的问题"></a>10，解决opencv的问题</h4><h4 id="11，解决openh264的问题"><a href="#11，解决openh264的问题" class="headerlink" title="11，解决openh264的问题"></a>11，解决openh264的问题</h4><p><img src="/images/openh264.png" alt="openh264.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">从git上下载源码</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;cisco&#x2F;openh264</span><br><span class="line">如果下载失败，则直接下载zip包，然后解压安装</span><br><span class="line">make ARCH&#x3D;x86_64</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h4 id="12，解决libopenjp2版本的问题"><a href="#12，解决libopenjp2版本的问题" class="headerlink" title="12，解决libopenjp2版本的问题"></a>12，解决libopenjp2版本的问题</h4><p><img src="/images/libopenjp2.png" alt="libopenjp2.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git下载源码来编译安装</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;uclouvain&#x2F;openjpeg.git</span><br><span class="line">如果下载不下来，则下载zip包解压安装 </span><br><span class="line">unzip openjpeg-master.zip</span><br><span class="line">cmake 安装</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake .. -DCMAKE_BUILD_TYPE&#x3D;Release</span><br><span class="line">make -j 10</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h4 id="13，解决opus的问题"><a href="#13，解决opus的问题" class="headerlink" title="13，解决opus的问题"></a>13，解决opus的问题</h4><p><img src="/images/opus.png" alt="opus.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#需要手动的下载安装</span><br><span class="line">https:&#x2F;&#x2F;ftp.osuosl.org&#x2F;pub&#x2F;xiph&#x2F;releases&#x2F;opus&#x2F;</span><br><span class="line">#安装步骤</span><br><span class="line">wget http:&#x2F;&#x2F;downloads.xiph.org&#x2F;releases&#x2F;opus&#x2F;opus-1.2.1.tar.gz</span><br><span class="line">tar -zxvf opus-1.2.1.tar.gz</span><br><span class="line">cd opus-1.2.1</span><br><span class="line">.&#x2F;configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">#注意：如果pkg_config没有找到，需要手动的设置路径，见前面PKG_CONFIG_PATH路径的设置，如果设置好之后，库也存在还是不行，则要检查是否使用yum下载了低版本的，若是则删除</span><br><span class="line">yum remove opus-1.0.2-6.el7.x86_64 opus-tools-0.1.6-1.el7.x86_64 opusfile-0.5-1.el7.x86_64 opus-devel-1.0.2-6.el7.x86_64 opusfile-devel-0.5-1.el7.x86_64</span><br></pre></td></tr></table></figure><h4 id="14，解决libpulse的问题"><a href="#14，解决libpulse的问题" class="headerlink" title="14，解决libpulse的问题"></a>14，解决libpulse的问题</h4><h4 id="15，解决libsoxr的问题"><a href="#15，解决libsoxr的问题" class="headerlink" title="15，解决libsoxr的问题"></a>15，解决libsoxr的问题</h4><p><img src="/images/libsoxr.png" alt="libsoxr.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#手动下载包，然后编译安装</span><br><span class="line">https:&#x2F;&#x2F;sourceforge.net&#x2F;projects&#x2F;soxr&#x2F;files&#x2F;</span><br><span class="line">tar -xvf soxr-0.1.3-Source.tar</span><br><span class="line">.&#x2F;go</span><br><span class="line">cd Realse</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p>在执行go的时候可能遇到这个问题,则需要下载cmake高级版本</p><p><img src="/images/go.png" alt="go.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cmake 安装</span><br><span class="line">https:&#x2F;&#x2F;cmake.org&#x2F;download&#x2F;</span><br><span class="line">tar -zxvf cmake-3.13.0-rc1.tar.gz</span><br><span class="line">.&#x2F;configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h4 id="16，解决speex的问题"><a href="#16，解决speex的问题" class="headerlink" title="16，解决speex的问题"></a>16，解决speex的问题</h4><p><img src="/images/speex.png" alt="speex.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">##手动下载安装包，编译，选择 libspeex下载</span><br><span class="line">https:&#x2F;&#x2F;xiph.org&#x2F;downloads&#x2F;</span><br><span class="line">.&#x2F;configure  --enable-shared</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h4 id="17，解决libtheora的问题"><a href="#17，解决libtheora的问题" class="headerlink" title="17，解决libtheora的问题"></a>17，解决libtheora的问题</h4><p><img src="/images/libtheora.png" alt="libtheora.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">## 手动下载安装包，编译，选择libtheora下载</span><br><span class="line">https:&#x2F;&#x2F;xiph.org&#x2F;downloads&#x2F;</span><br><span class="line">unzip libtheora-1.1.1.zip</span><br><span class="line">.&#x2F;configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在configure的过程中，可能error,则我们需要下载安装这个</p><p><img src="/images/ogg.png" alt="ogg.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libogg*</span><br></pre></td></tr></table></figure><h4 id="18，解决libv412的问题"><a href="#18，解决libv412的问题" class="headerlink" title="18，解决libv412的问题"></a>18，解决libv412的问题</h4><h4 id="19，解决vorbis的问题"><a href="#19，解决vorbis的问题" class="headerlink" title="19，解决vorbis的问题"></a>19，解决vorbis的问题</h4><p><img src="/images/vorbis.png" alt="vorbis.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;xiph&#x2F;vorbis.git</span><br><span class="line">.&#x2F;autogen.sh</span><br><span class="line">.&#x2F;configure  --enable-shared</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h4 id="20，解决libx264的问题"><a href="#20，解决libx264的问题" class="headerlink" title="20，解决libx264的问题"></a>20，解决libx264的问题</h4><p><img src="/images/libx264.png" alt="h264.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone --depth 1 http:&#x2F;&#x2F;git.videolan.org&#x2F;git&#x2F;x264</span><br><span class="line">.&#x2F;configure --enable-shared</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p>如果编译时报错，则需要安装nasm</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -O -L http:&#x2F;&#x2F;www.nasm.us&#x2F;pub&#x2F;nasm&#x2F;releasebuilds&#x2F;2.13.02&#x2F;nasm-2.13.02.tar.bz2  </span><br><span class="line">tar -xjvf nasm-2.13.02.tar.bz2</span><br><span class="line">cd nasm-2.13.02</span><br><span class="line">.&#x2F;autogen.sh </span><br><span class="line">.&#x2F;configure  --enable-shared </span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="21，解决libx265的问题"><a href="#21，解决libx265的问题" class="headerlink" title="21，解决libx265的问题"></a>21，解决libx265的问题</h4><p><img src="/images/x265.png" alt="x265.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone  --depth 1 https:&#x2F;&#x2F;github.com&#x2F;videolan&#x2F;x265.git</span><br><span class="line">cd x265</span><br><span class="line">cd build</span><br><span class="line">cmake ..&#x2F;source</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h4 id="22，解决libxvid的问题"><a href="#22，解决libxvid的问题" class="headerlink" title="22，解决libxvid的问题"></a>22，解决libxvid的问题</h4><p><img src="/images/libxvid.png" alt="libxvid.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">##官网下载</span><br><span class="line">https:&#x2F;&#x2F;www.xvid.com&#x2F;download&#x2F;</span><br><span class="line">## 按下图过程来查找</span><br><span class="line">## 然后按照README来安装</span><br><span class="line">cd build&#x2F;generic</span><br><span class="line">.&#x2F;configure</span><br><span class="line">make -j 10</span><br><span class="line"></span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p><img src="/images/xvid.png" alt=" xvid"></p><p><img src="C:/Users/Administrator/Desktop/leopard4.1/images/readme.png" alt="readme.png"></p><p><img src="/images/bar.png" alt="bar.png"></p><h4 id="23，解决openal的问题"><a href="#23，解决openal的问题" class="headerlink" title="23，解决openal的问题"></a>23，解决openal的问题</h4><p><img src="/images/openal.png" alt="openal.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install openal-soft openal-soft-devel</span><br></pre></td></tr></table></figure><h4 id="24，解决libcdio的问题"><a href="#24，解决libcdio的问题" class="headerlink" title="24，解决libcdio的问题"></a>24，解决libcdio的问题</h4><h4 id="25，解决bzlib的问题"><a href="#25，解决bzlib的问题" class="headerlink" title="25，解决bzlib的问题"></a>25，解决bzlib的问题</h4><h4 id="26，解决libxcb的问题"><a href="#26，解决libxcb的问题" class="headerlink" title="26，解决libxcb的问题"></a>26，解决libxcb的问题</h4><p><img src="/images/libxcb.png" alt="libxcb.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libxcb-devel</span><br></pre></td></tr></table></figure><h2 id="四，添加硬件编解码"><a href="#四，添加硬件编解码" class="headerlink" title="四，添加硬件编解码"></a>四，添加硬件编解码</h2><h4 id="1，查看机器上显卡的型号"><a href="#1，查看机器上显卡的型号" class="headerlink" title="1，查看机器上显卡的型号"></a>1，查看机器上显卡的型号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci | grep VGA</span><br></pre></td></tr></table></figure><p><img src="/images/vga.png" alt="vga"></p><h4 id="2，安装对应显卡的驱动"><a href="#2，安装对应显卡的驱动" class="headerlink" title="2，安装对应显卡的驱动"></a>2，安装对应显卡的驱动</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.nvidia.com&#x2F;Download&#x2F;index.aspx?lang&#x3D;en-us</span><br><span class="line">安装的方法见显卡驱动安装的文档</span><br></pre></td></tr></table></figure><h4 id="3，重新编译ffmpeg"><a href="#3，重新编译ffmpeg" class="headerlink" title="3，重新编译ffmpeg"></a>3，重新编译ffmpeg</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">在.&#x2F;configure时添加以下的选项，来重新编译ffmpeg，既可以驱动显卡</span><br><span class="line">--enable-cuda-sdk \</span><br><span class="line">--enable-cuvid \</span><br><span class="line">--enable-nvenc \</span><br><span class="line">--enable-nonfree \</span><br><span class="line">--enable-libnpp \</span><br><span class="line">--extra-cflags&#x3D;-I&#x2F;usr&#x2F;local&#x2F;cuda&#x2F;include \</span><br><span class="line">--extra-ldflags&#x3D;-L&#x2F;usr&#x2F;local&#x2F;cuda&#x2F;lib64 \</span><br></pre></td></tr></table></figure><h4 id="4，查看是否安装成功"><a href="#4，查看是否安装成功" class="headerlink" title="4，查看是否安装成功"></a>4，查看是否安装成功</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">使用ffmpeg -hwaccels命令查看支持的硬件加速选项</span><br><span class="line">ffmpeg -hwaccels</span><br></pre></td></tr></table></figure><p><img src="/images/hw.png" alt="hw.png"></p><h4 id="5，查看cuvid提供的GPU编解码器"><a href="#5，查看cuvid提供的GPU编解码器" class="headerlink" title="5，查看cuvid提供的GPU编解码器"></a>5，查看cuvid提供的GPU编解码器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -codecs | grep cuvid</span><br></pre></td></tr></table></figure><p><img src="/images/cuvid.png" alt="cuvid.png"></p><h4 id="6，使用GPU进行转码"><a href="#6，使用GPU进行转码" class="headerlink" title="6，使用GPU进行转码"></a>6，使用GPU进行转码</h4><blockquote><p>用GPU进行转码的命令和软转码命令不太一样，CPU转码的时候，我们可以依赖ffmpeg识别输入视频的编码格式并选择对应的解码器，但ffmpeg只会自动选择CPU解码器，要让ffmpeg使用GPU解码器，必须先用ffprobe识别出输入视频的编码格式，然后在命令行中指定对应的GPU解码器。</p><p>例如，将h264编码的源视频转码为指定尺寸和码率的h264编码视频：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg  -hwaccel cuvid -c:v h264_cuvid -i video&#x2F;video-H264-AAC.mkv -c:v h264_nvenc -b:v 2048k -vf scale_npp&#x3D;1280:-1 -y &#x2F;root&#x2F;transcode.mp4</span><br><span class="line"></span><br><span class="line">-hwaccel cuvid：指定使用cuvid硬件加速</span><br><span class="line">-c:v h264_cuvid：使用h264_cuvid进行视频解码</span><br><span class="line">-c:v h264_nvenc：使用h264_nvenc进行视频编码</span><br><span class="line">-vf scale_npp&#x3D;1280:-1：指定输出视频的宽高，注意，这里和软解码时使用的-vf scale&#x3D;x:x不一样</span><br><span class="line">转码期间使用nvidia-smi查看显卡状态，能够看到ffmpeg确实是在使用GPU进行转码：</span><br></pre></td></tr></table></figure><p>如果在执行命令的时候报错，则需要,进行nv-codec-headers和驱动的版本匹配的处理</p><p><img src="/images/drive.png" alt="drive.png"></p><p>我开始编译nv-codec-headers使用的是最新版本9.1的，编译出错，有两种方法，一种是升级drive的版本，升级到430以上，这个比较的麻烦，另一种是降低nv-codec-headers的版本，我降低到8.1版本，就可以成功</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg 版本 ffmpeg version n4.1.1-3-g53f3f52</span><br><span class="line">cuda 版本 CUDA Version 10.0.130（这个版本自带驱动，可以不用安装驱动）</span><br><span class="line">drive 驱动版本 Driver Version: 410.48 </span><br><span class="line">nv-codec-headers 版本 sdk&#x2F;8.1</span><br></pre></td></tr></table></figure><h4 id="7-在容器中使用NVIDIA"><a href="#7-在容器中使用NVIDIA" class="headerlink" title="7,在容器中使用NVIDIA"></a>7,在容器中使用NVIDIA</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在将自己的服务打包成镜像的时候，开始没有设置环境变量，导致怎么都无法调用NVIDIA进行硬件的转码；</span><br><span class="line">最后查询了很多的资料，发现需要添加一个环境变量，在Dockfile中</span><br><span class="line">ENV NVIDIA_DRIVER_CAPABILITIES video,compute,utility</span><br><span class="line">才能保证容器中使用成功</span><br></pre></td></tr></table></figure><h4 id="8，gpu和cpu转码测试"><a href="#8，gpu和cpu转码测试" class="headerlink" title="8，gpu和cpu转码测试"></a>8，gpu和cpu转码测试</h4><p>​ 对于同一个视频，分别采用cpu和GPU两种方式来进行转码，对比这两者之间的效率</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#机器信息</span><br><span class="line">逻辑核：24</span><br><span class="line">内存：64G</span><br><span class="line">24  Intel(R) Xeon(R) CPU E5-2620 v2 @ 2.10GHz</span><br><span class="line">系统：CentOS Linux release 7.6.1810 (Core)</span><br><span class="line">#视频信息：</span><br><span class="line">name: 11.mkv</span><br><span class="line">size： 1.1G</span><br><span class="line">Video: h264 (High), yuv420p(progressive), 1280x720 [SAR 1:1 DAR 16:9], 25 fps, 25 tbr, 1k tbn, 50 tbc (default)</span><br><span class="line">Audio: ac3, 48000 Hz, stereo, fltp, 192 kb&#x2F;s (default)</span><br><span class="line">#软件转码：</span><br><span class="line">[time] ffmpeg  -i video&#x2F;11.mkv -c:v libx264 -b:v 2048k -vf scale&#x3D;1280:-1 -y &#x2F;root&#x2F;transcode.mp4</span><br><span class="line">#结果</span><br><span class="line">real	11m18.807s</span><br><span class="line">user	180m16.290s</span><br><span class="line">sys		1m36.925s</span><br><span class="line">cpu占用	平均1600%</span><br><span class="line">[time] .&#x2F;softhw &#x2F;root&#x2F;video&#x2F;11.mkv &#x2F;opt&#x2F;nvitra1.mp4</span><br><span class="line">real	14m51.166s</span><br><span class="line">user	220m2.857s</span><br><span class="line">sys		1m21.718s</span><br><span class="line">cpu占用  平均1600%</span><br><span class="line">#硬件转码：</span><br><span class="line">[time] ffmpeg  -hwaccel cuvid -c:v h264_cuvid -i video&#x2F;11.mkv -c:v h264_nvenc -b:v 2048k -vf scale_npp&#x3D;1280:-1 -y &#x2F;root&#x2F;transcode.mp4</span><br><span class="line">#结果</span><br><span class="line">real	1m45.228s</span><br><span class="line">user	1m15.910s</span><br><span class="line">sys		0m18.734s</span><br><span class="line">cpu占用	平均90%</span><br><span class="line">[time] .&#x2F;hw &#x2F;root&#x2F;video&#x2F;11.mkv &#x2F;opt&#x2F;nvitra.mp4</span><br><span class="line">real	1m29.478s</span><br><span class="line">user	0m22.754s</span><br><span class="line">sys		0m23.465s</span><br><span class="line">cpu占用 50%</span><br></pre></td></tr></table></figure><h4 id="8，指定显卡进行转码"><a href="#8，指定显卡进行转码" class="headerlink" title="8，指定显卡进行转码"></a>8，指定显卡进行转码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -hwaccel cuvid -hwaccel_device 0 -c:v h264_cuvid -i &lt;input&gt; -c:v h264_nvenc -b:v 2048k -vf scale_npp&#x3D;1280:-1 -y &lt;output&gt;</span><br><span class="line"></span><br><span class="line">ffmpeg -hwaccel cuvid -hwaccel_device 1 -c:v h264_cuvid -i &lt;input&gt; -c:v h264_nvenc -b:v 2048k -vf scale_npp&#x3D;1280:-1 -y &lt;output&gt;</span><br><span class="line"></span><br><span class="line">ffmpeg -hwaccel cuvid -hwaccel_device 0 -c:v h264_cuvid -i &#x2F;root&#x2F;source_media&#x2F;flv.flv -c:v h264_nvenc -b:v 2048k -vf scale_npp&#x3D;1280:-1  -y &#x2F;root&#x2F;flv.mp4</span><br></pre></td></tr></table></figure></div><div class="reward-container"><div>您的打赏是对我最大的支持.</div> <button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'> 打赏</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="/images/reward/alipay.jpg" alt="Helioswei 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> Helioswei</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="http://www.helioswei.top/article/2764140538.html" title="ffmpeg-源码编译支持GPU">http://www.helioswei.top/article/2764140538.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"><p>欢迎关注我的其它发布渠道</p><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/images/reward/wechat.jpg"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/ffmpeg/" rel="tag"><i class="fa fa-tag"></i> ffmpeg</a><a href="/tags/GPU/" rel="tag"><i class="fa fa-tag"></i> GPU</a></div><div class="post-nav"><div class="post-nav-item"><a href="/article/3448999942.html" rel="prev" title="image-libvips图片处理库源码编译"><i class="fa fa-chevron-left"></i> image-libvips图片处理库源码编译</a></div><div class="post-nav-item"> <a href="/article/1473358207.html" rel="next" title="grpc编译">grpc编译<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%EF%BC%8Cffmpeg%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%8B%E8%BD%BD"><span class="nav-number">1.</span> <span class="nav-text">一，ffmpeg源码的下载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%EF%BC%8C%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E7%9A%84%E5%87%86%E5%A4%87"><span class="nav-number">2.</span> <span class="nav-text">二，基础环境的准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%EF%BC%8C%E7%BC%96%E7%A0%81%E8%BF%87%E7%A8%8B"><span class="nav-number">3.</span> <span class="nav-text">三，编码过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%BC%8C%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E8%B7%AF%E5%BE%84"><span class="nav-number">3.0.1.</span> <span class="nav-text">1，设置环境路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%BC%8C%E7%BC%96%E7%A0%81"><span class="nav-number">3.0.2.</span> <span class="nav-text">2，编码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%BC%8C%E8%A7%A3%E5%86%B3gnutls%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.3.</span> <span class="nav-text">3，解决gnutls的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%EF%BC%8C%E8%A7%A3%E5%86%B3ladspa-h%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.4.</span> <span class="nav-text">4，解决ladspa.h的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%EF%BC%8C%E8%A7%A3%E5%86%B3libass%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.5.</span> <span class="nav-text">5，解决libass的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%EF%BC%8C%E8%A7%A3%E5%86%B3libdc1394-2%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.6.</span> <span class="nav-text">6，解决libdc1394-2的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7%EF%BC%8C%E8%A7%A3%E5%86%B3libgsm%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.7.</span> <span class="nav-text">7，解决libgsm的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8%EF%BC%8C%E8%A7%A3%E5%86%B3libmp3lame%E7%89%88%E6%9C%AC%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.8.</span> <span class="nav-text">8，解决libmp3lame版本的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9%EF%BC%8C%E8%A7%A3%E5%86%B3libopencore-amrnb%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.9.</span> <span class="nav-text">9，解决libopencore_amrnb的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10%EF%BC%8C%E8%A7%A3%E5%86%B3opencv%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.10.</span> <span class="nav-text">10，解决opencv的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11%EF%BC%8C%E8%A7%A3%E5%86%B3openh264%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.11.</span> <span class="nav-text">11，解决openh264的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12%EF%BC%8C%E8%A7%A3%E5%86%B3libopenjp2%E7%89%88%E6%9C%AC%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.12.</span> <span class="nav-text">12，解决libopenjp2版本的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13%EF%BC%8C%E8%A7%A3%E5%86%B3opus%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.13.</span> <span class="nav-text">13，解决opus的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14%EF%BC%8C%E8%A7%A3%E5%86%B3libpulse%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.14.</span> <span class="nav-text">14，解决libpulse的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15%EF%BC%8C%E8%A7%A3%E5%86%B3libsoxr%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.15.</span> <span class="nav-text">15，解决libsoxr的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16%EF%BC%8C%E8%A7%A3%E5%86%B3speex%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.16.</span> <span class="nav-text">16，解决speex的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#17%EF%BC%8C%E8%A7%A3%E5%86%B3libtheora%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.17.</span> <span class="nav-text">17，解决libtheora的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#18%EF%BC%8C%E8%A7%A3%E5%86%B3libv412%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.18.</span> <span class="nav-text">18，解决libv412的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#19%EF%BC%8C%E8%A7%A3%E5%86%B3vorbis%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.19.</span> <span class="nav-text">19，解决vorbis的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20%EF%BC%8C%E8%A7%A3%E5%86%B3libx264%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.20.</span> <span class="nav-text">20，解决libx264的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#21%EF%BC%8C%E8%A7%A3%E5%86%B3libx265%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.21.</span> <span class="nav-text">21，解决libx265的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#22%EF%BC%8C%E8%A7%A3%E5%86%B3libxvid%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.22.</span> <span class="nav-text">22，解决libxvid的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#23%EF%BC%8C%E8%A7%A3%E5%86%B3openal%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.23.</span> <span class="nav-text">23，解决openal的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#24%EF%BC%8C%E8%A7%A3%E5%86%B3libcdio%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.24.</span> <span class="nav-text">24，解决libcdio的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#25%EF%BC%8C%E8%A7%A3%E5%86%B3bzlib%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.25.</span> <span class="nav-text">25，解决bzlib的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#26%EF%BC%8C%E8%A7%A3%E5%86%B3libxcb%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.0.26.</span> <span class="nav-text">26，解决libxcb的问题</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%EF%BC%8C%E6%B7%BB%E5%8A%A0%E7%A1%AC%E4%BB%B6%E7%BC%96%E8%A7%A3%E7%A0%81"><span class="nav-number">4.</span> <span class="nav-text">四，添加硬件编解码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%BC%8C%E6%9F%A5%E7%9C%8B%E6%9C%BA%E5%99%A8%E4%B8%8A%E6%98%BE%E5%8D%A1%E7%9A%84%E5%9E%8B%E5%8F%B7"><span class="nav-number">4.0.1.</span> <span class="nav-text">1，查看机器上显卡的型号</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%BC%8C%E5%AE%89%E8%A3%85%E5%AF%B9%E5%BA%94%E6%98%BE%E5%8D%A1%E7%9A%84%E9%A9%B1%E5%8A%A8"><span class="nav-number">4.0.2.</span> <span class="nav-text">2，安装对应显卡的驱动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%BC%8C%E9%87%8D%E6%96%B0%E7%BC%96%E8%AF%91ffmpeg"><span class="nav-number">4.0.3.</span> <span class="nav-text">3，重新编译ffmpeg</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%EF%BC%8C%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F"><span class="nav-number">4.0.4.</span> <span class="nav-text">4，查看是否安装成功</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%EF%BC%8C%E6%9F%A5%E7%9C%8Bcuvid%E6%8F%90%E4%BE%9B%E7%9A%84GPU%E7%BC%96%E8%A7%A3%E7%A0%81%E5%99%A8"><span class="nav-number">4.0.5.</span> <span class="nav-text">5，查看cuvid提供的GPU编解码器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%EF%BC%8C%E4%BD%BF%E7%94%A8GPU%E8%BF%9B%E8%A1%8C%E8%BD%AC%E7%A0%81"><span class="nav-number">4.0.6.</span> <span class="nav-text">6，使用GPU进行转码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-%E5%9C%A8%E5%AE%B9%E5%99%A8%E4%B8%AD%E4%BD%BF%E7%94%A8NVIDIA"><span class="nav-number">4.0.7.</span> <span class="nav-text">7,在容器中使用NVIDIA</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8%EF%BC%8Cgpu%E5%92%8Ccpu%E8%BD%AC%E7%A0%81%E6%B5%8B%E8%AF%95"><span class="nav-number">4.0.8.</span> <span class="nav-text">8，gpu和cpu转码测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8%EF%BC%8C%E6%8C%87%E5%AE%9A%E6%98%BE%E5%8D%A1%E8%BF%9B%E8%A1%8C%E8%BD%AC%E7%A0%81"><span class="nav-number">4.0.9.</span> <span class="nav-text">8，指定显卡进行转码</span></a></li></ol></li></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Helioswei" src="/images/avatar.jpeg"><p class="site-author-name" itemprop="name">Helioswei</p><div class="site-description" itemprop="description">江南烟雨浓</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">51</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">24</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">38</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/SunnyWeiLucky" title="GitHub → https://github.com/SunnyWeiLucky" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:helioswei1995@gmail.com" title="E-Mail → mailto:helioswei1995@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Helioswei</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="站点阅读时长">1:04</span></div><br> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("04/21/2019 15:54:40");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站已安全运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}setInterval("createtime()",250)</script><script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"i5ElMJKye9V7BCm2CC3XaNjc-MdYXbMMI","app_key":"p5zahXig7ASIdYRIOMBqxgkw","server_url":null,"security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script defer="defer" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three.min.js"></script><script defer="defer" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@latest/three-waves.min.js"></script><script defer="defer" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@latest/canvas_lines.min.js"></script><script defer="defer" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@latest/canvas_sphere.min.js"></script><script src="/js/local-search.js"></script><script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'i5ElMJKye9V7BCm2CC3XaNjc-MdYXbMMI',
      appKey     : 'p5zahXig7ASIdYRIOMBqxgkw',
      placeholder: "欢迎畅所预言",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script><script type="text/javascript" src="/js/src/clicklove.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"right",width:150,height:300},mobile:{show:!0},react:{opacity:.7}})</script></body></html>